<html>
  <head>
    <script src="vendors/aframe/aframe.1.2.0.min.js"></script>
    <script src="js/logger.js"></script>

    <script src="https://unpkg.com/aframe-event-set-component@3.0.3/dist/aframe-event-set-component.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.2.0/dist/aframe-environment-component.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>

    
    
    <script type="module">
        AFRAME.registerComponent('walk', {
          isVelocityActive: function () {
            return false;
          },
          getPositionDelta: function () {
            return new THREE.Vector3(1, 0, 0);
          }
        });
    </script>
</head>
  <body>
    <a-scene log="console: false" stats="false" environment="preset:tron">

        <a-assets>
            <!-- preloaded items -->
            <a-asset-item id="m16-obj" src="/3d/guns/m16/m16.obj"></a-asset-item>
            <a-asset-item id="m16-mtl" src="/3d/guns/m16/m16.mtl"></a-asset-item>
        </a-assets>

        <!-- sky -->
        <a-sky color="#ECECEC"></a-sky>

        <!-- scene -->
        <a-box position="-1 0.5 -3" rotation="0 45 0" color="#4CC3D9"
            event-set__enter="_event: mouseenter; color: #8FF7FF"
            event-set__leave="_event: mouseleave; color: #4CC3D9">
        </a-box>
        <a-sphere position="0 1.25 -5" radius="1.25" color="#EF2D5E"></a-sphere>
        <a-cylinder position="1 0.75 -3" radius="0.5" height="1.5" color="#FFC65D"></a-cylinder>
        <a-plane position="0 0.01 -4" rotation="-90 0 0" width="40" height="40" color="#7BC8A4"></a-plane>



        <!-- player -->
        <a-entity movement-controls="easing:0;acceleration:100" id="player" position="0 0 0">

            <!-- eyes (main camera) -->
            <a-camera id="camera" look-controls="pointerLockEnabled: true" position="0 1.6 0">

                <!-- target -->
                <a-cursor></a-cursor>

                <!-- gun for non VR device, should be moved when entering XR mode --> 
                <a-entity
                    id="m16" 
                    obj-model="obj: #m16-obj; mtl: #m16-mtl" 
                    scale="0.01 0.01 0.01" 
                    position="0.3 -0.3 -0.5"
                    rotation="0 -90 0">
                </a-entity>

            </a-camera>

            <a-entity id="tracked" tracked-controls="controller: 0; idPrefix: OpenVR"></a-entity>

            <a-entity laser-controls raycaster="objects: .links; far: 50; lineColor: red; lineOpacity: 0.9"></a-entity>
            <a-entity id="leftHand" laser-controls="hand: left;"></a-entity>
            <a-entity id="rightHand" laser-controls="hand: right;"></a-entity>

        </a-entity>

        <a-entity position="2 1.6 -1">
            <a-entity log geometry="primitive: plane" material></a-entity>
            <a-entity log="channel: foo" geometry="primitive: plane" material></a-entity>
        </a-entity>

        <!-- https://stackoverflow.com/questions/60336076/a-frame-superhands-custom-hand-model -->
        <a-mixin id="controllers-right" oculus-touch-controls="hand: right" gltf-model="./Models/Hand.glb"  scale="0.05 0.05 0.05"></a-mixin>

    </a-scene>

    
    <script type="module">
        
        import * as player from './js/player.js';
        
        // random player location when page loaded
        //player.setRandomPosition(-5, 5);

        function onControllerConnected() {
            AFRAME.log('onControllerConnected', arguments);
        }

        function onAxisMove() {
            AFRAME.log('onAxisMove', arguments);
        }

        function onButtonChanged() {
            AFRAME.log('onButtonChanged', arguments);
        }

        function onButtonDown() {
            AFRAME.log('onButtonDown', arguments);
        }

        function onButtonUp() {
            AFRAME.log('onButtonUp', arguments);
        }

        function onTouchStart() {
            AFRAME.log('onTouchStart', arguments);
        }

        function onTouchEnd() {
            AFRAME.log('onTouchEnd', arguments);
        }

        function attach(elName) {
            const el = document.querySelector(elName);
            if (!el) {
                AFRAME.log('attach: could not find '+elName);
                return;
            }

            el.addEventListener("controllerconnected", onControllerConnected, false);
            el.addEventListener("axismove", onAxisMove, false);
            el.addEventListener("buttonchanged", onButtonChanged, false);
            el.addEventListener("buttondown", onButtonDown, false);
            el.addEventListener("buttonup", onButtonUp, false);
            el.addEventListener("touchstart", onTouchStart, false);
            el.addEventListener("touchend", onTouchEnd, false);

            AFRAME.log('attach: events attached to '+elName);
            
        }

        //attach('#tracked');
        attach('#leftHand');
        attach('#rightHand');
        

        setTimeout(() => {
            AFRAME.log('hello');
        });

    </script>
    
  </body>
</html>